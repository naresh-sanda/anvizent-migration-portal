<!DOCTYPE html>
<html>

<head>
    <title>Anvizent Migration Portal</title>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #10b981;
            /* Green 500 */
            --primary-hover: #059669;
            /* Green 600 */
            --bg-body: #f8fafc;
            /* Slate 50 */
            --bg-sidebar: #ffffff;
            --text-main: #334155;
            /* Slate 700 */
            --text-muted: #64748b;
            /* Slate 500 */
            --border-color: #e2e8f0;
            /* Slate 200 */
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --sidebar-width: 260px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: var(--bg-body);
            color: var(--text-main);
        }

        /* --- LAYOUT --- */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            color: var(--text-main);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            box-shadow: 1px 0 0 var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 50;
        }

        .sidebar-brand {
            padding: 0 16px 24px 16px;
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 16px;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .sidebar a:hover {
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .sidebar a.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.4);
        }

        .sidebar-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            font-weight: 700;
            padding: 16px 16px 8px 16px;
            margin-top: 8px;
        }

        /* --- MAIN CONTENT & HEADER --- */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            display: flex;
            flex-direction: column;
            width: calc(100% - var(--sidebar-width));
        }

        .header {
            background: white;
            /* Transparent/White */
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid transparent;
            /* Or keep border? Screenshot looks clean */
            /* sticky header */
            position: sticky;
            top: 0;
            z-index: 40;
            /* backdrop-filter: blur(8px); */
            /* background: rgba(255,255,255,0.8); */
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .breadcrumb {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            background: white;
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            width: 240px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-bar:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
        }

        .user-profile {
            font-size: 14px;
            font-weight: 500;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }

        /* --- CARDS & DASHBOARD --- */
        .page-content {
            padding: 32px;
            animation: fadeIn 0.4s ease;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.02);
            margin-bottom: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.02);
            position: relative;
            overflow: hidden;
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: absolute;
            top: -10px;
            right: 20px;
            /* Floating icon style */
            width: 64px;
            height: 64px;
            top: -15px;
            opacity: 0.1;
            /* Watermark style */
        }

        /* Material Dashboard Card Style */
        .material-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 140px;
        }

        .material-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            /* Slightly rounded */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
            position: absolute;
            top: -16px;
            left: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .material-stat-content {
            text-align: right;
            margin-top: 8px;
        }

        .material-stat-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .material-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-top: 4px;
        }

        .material-stat-footer {
            margin-top: 20px;
            padding-top: 12px;
            border-top: 1px solid #f1f5f9;
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            gap: 6px;
        }

        .trend-up {
            color: #10b981;
            font-weight: 600;
        }

        .trend-down {
            color: #ef4444;
            font-weight: 600;
        }

        /* Chart Card */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Button Overrides */
        .btn-primary {
            background: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .badge {
            background: #e0f2fe;
            color: #0369a1;
            /* Blue for badges still? or Green? Let's check context. Keeping blue for generic. */
        }

        .mode-selector {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .mode-card {
            flex: 1;
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .mode-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .mode-card.selected {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .mode-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .mode-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 6px;
        }

        .mode-desc {
            font-size: 12px;
            color: #6b7280;
            line-height: 1.4;
        }

        .section-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 18px;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-badge {
            background: #10b981;
            color: white;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #374151;
            font-size: 14px;
        }

        select,
        input[type="text"] {
            padding: 10px 12px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        select:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: #10b981;
        }

        .form-row {
            display: flex;
            gap: 24px;
            margin-bottom: 16px;
        }

        .form-col {
            flex: 1;
        }

        .radio-group {
            margin-bottom: 12px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-group:hover {
            background: #fdfdfd;
            border-color: #10b981;
        }

        .radio-group input[type="radio"] {
            margin-right: 10px;
        }

        .radio-group label {
            cursor: pointer;
            margin: 0;
            font-weight: 400;
        }

        .btn-primary {
            background: #10b981;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-primary:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .mapping-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            font-size: 13px;
        }

        .mapping-table th {
            background: linear-gradient(to bottom, #f9fafb, #f3f4f6);
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        .mapping-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #f3f4f6;
            background: white;
            vertical-align: middle;
        }

        .mapping-table tbody tr:hover {
            background: #f9fafb;
        }

        .mapping-table tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        .mapping-table tbody tr:nth-child(even):hover {
            background: #f3f4f6;
        }

        .mapping-table td strong {
            color: #1e293b;
            font-weight: 600;
            font-size: 13px;
        }

        .mapping-table select {
            margin: 0;
            width: 100%;
            padding: 6px 8px;
            font-size: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            background: white;
        }

        .mapping-table select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .mapping-table input[type="text"] {
            padding: 6px 8px;
            font-size: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }

        .mapping-table input[type="text"]:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .mapping-table input[type="checkbox"] {
            width: auto;
        }

        .info-box {
            background: #ecfdf5;
            border-left: 4px solid #10b981;
            padding: 14px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            color: #065f46;
            font-size: 14px;
        }

        /* Toggle Switch Styles */
        .toggle-container {
            display: inline-flex;
            align-items: center;
            gap: 16px;
            background: #f9fafb;
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .toggle-label {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            transition: color 0.3s;
        }

        .toggle-label.active {
            color: #10b981;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #10b981;
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked+.toggle-slider {
            background-color: #10b981;
        }

        input:not(:checked)+.toggle-slider {
            background-color: #cbd5e1;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-slider:hover {
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
        }

        .hidden {
            display: none;
        }

        .page-content {
            display: block;
        }

        .page-content.hidden {
            display: none;
        }

        .add-row-btn {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 10px;
        }

        .add-row-btn:hover {
            background: #059669;
        }

        .selected-tables-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 40px;
            padding: 12px;
            background: #f9fafb;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
        }

        .selected-tables-container:empty::before {
            content: 'No tables selected. Select from dropdown above.';
            color: #9ca3af;
            font-size: 13px;
        }

        .table-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: #10b981;
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }

        .table-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .table-tag .remove-tag:hover {
            opacity: 1;
        }

        /* --- WIZARD / STEPPER STYLES --- */
        .stepper-wrapper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 0 40px;
            position: relative;
        }

        .stepper-wrapper::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 2px;
            background: #e2e8f0;
            z-index: 0;
        }

        .stepper-item {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .step-counter {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fff;
            border: 2px solid #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .step-name {
            font-size: 13px;
            color: #94a3b8;
            font-weight: 500;
            transition: all 0.3s;
        }

        .stepper-item.active .step-counter {
            border-color: #10b981;
            background: #10b981;
            color: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }

        .stepper-item.completed .step-counter {
            border-color: #10b981;
            background: #10b981;
            color: white;
        }

        .stepper-item.active .step-name {
            color: #10b981;
            font-weight: 600;
        }

        .stepper-item.completed .step-name {
            color: #10b981;
        }

        .wizard-step {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .wizard-step.active {
            display: block;
        }

        .wizard-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- DM SOURCE CRUD STYLES --- */
        .crud-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .crud-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .crud-table th {
            background: #f3f4f6;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .crud-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            color: #4b5563;
            font-size: 14px;
        }

        .crud-table tr:last-child td {
            border-bottom: none;
        }

        .crud-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #6b7280;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            color: #111827;
            background: #f3f4f6;
        }

        .btn-icon.delete:hover {
            color: #ef4444;
            background: #fee2e2;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-container {
            background: white;
            width: 500px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        .modal-header {
            padding: 16px 24px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-weight: 600;
            font-size: 16px;
            color: #111827;
        }

        .close-modal {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #9ca3af;
        }

        .close-modal:hover {
            color: #4b5563;
        }

        .modal-body {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 24px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        /* --- LOAD STRATEGY CARDS --- */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .strategy-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: #fff;
        }

        .strategy-card:hover {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .strategy-card.selected {
            border-color: #10b981;
            background: #ecfdf5;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .strategy-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: #64748b;
        }

        .strategy-card.selected .strategy-icon {
            color: #10b981;
        }

        .strategy-title {
            font-weight: 600;
            font-size: 14px;
            color: #334155;
            margin-bottom: 4px;
        }

        .strategy-desc {
            font-size: 12px;
            color: #64748b;
            line-height: 1.4;
        }

        .rules-container {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        /* --- STEP 5 SUMMARY & VALIDATION --- */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .summary-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .summary-value {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }

        .validation-box {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            background: #fff;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .validation-box.pending {
            background: #fff;
            border-left: 4px solid #cbd5e1;
        }

        .validation-box.validating {
            background: #fff;
            border-left: 4px solid #f59e0b;
        }

        .validation-box.success {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
        }

        .validation-box.error {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
        }

        .validation-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f1f5f9;
            color: #64748b;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .validation-box.success .validation-icon {
            background: #d1fae5;
            color: #10b981;
        }

        .validation-box.error .validation-icon {
            background: #fee2e2;
            color: #ef4444;
        }

        .validation-content {
            flex: 1;
        }

        .validation-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .validation-desc {
            font-size: 13px;
            color: #64748b;
        }

        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .action-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.2s;
        }

        .action-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .action-card h4 {
            margin: 0 0 8px 0;
            color: #1e293b;
        }

        .action-card p {
            margin: 0 0 16px 0;
            font-size: 13px;
            color: #64748b;
        }

        /* --- EXPORT MODAL --- */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 16px;
        }

        .modal-tab {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .modal-tab:hover {
            color: #1e293b;
        }

        .modal-tab.active {
            color: #10b981;
            border-bottom-color: #10b981;
        }

        .json-display {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            height: 400px;
            overflow: auto;
            white-space: pre-wrap;
            margin-bottom: 16px;
        }

        .copy-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-content {
            display: none;
            position: relative;
        }

        .tab-content.active {
            display: block;
        }

        /* --- LINEAGE VISUALIZATION --- */
        .node rect {
            fill: white;
            stroke: #cbd5e1;
            stroke-width: 1px;
            rx: 6;
            ry: 6;
            transition: all 0.3s;
        }

        .node:hover rect {
            stroke: #10b981;
            stroke-width: 2px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        .node text {
            font-size: 12px;
            fill: #1e293b;
            font-weight: 500;
            pointer-events: none;
        }

        .node .label-sub {
            font-size: 10px;
            fill: #64748b;
        }

        .link {
            fill: none;
            stroke: #cbd5e1;
            stroke-width: 2px;
            opacity: 0.6;
            transition: all 0.3s;
        }

        .link:hover {
            stroke: #10b981;
            stroke-width: 3px;
            opacity: 1;
        }

        .link.active {
            stroke: #10b981;
            opacity: 1;
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- Sidebar with Material Shadcn Style -->
        <div class="sidebar">
            <div class="sidebar-brand" style="display: flex; align-items: center; gap: 10px;">
                <span style="font-weight: 600;">Migration Portal</span>
            </div>

            <a href="#dashboard" class="active" onclick="navigateTo('dashboard', event)">
                <span>üìä</span> Dashboard
            </a>

            <div class="sidebar-section-title">CONNECTIONS</div>
            <a href="#dmsource" onclick="navigateTo('dmsource', event)">
                <span>üì¶</span> DM Source
            </a>
            <a href="#connections" onclick="navigateTo('connections', event)">
                <span>üîå</span> Data Source
            </a>

            <div class="sidebar-section-title">TOOLS</div>
            <a href="#migration" onclick="navigateTo('migration', event)">
                <span>üîÑ</span> Migration Wizard
            </a>
            <a href="#schedules" onclick="navigateTo('schedules', event)">
                <span>‚è∞</span> Schedules
            </a>
            <a href="#monitoring" onclick="navigateTo('monitoring', event)">
                <span>üìà</span> Monitoring
            </a>
        </div>

        <div class="main-content">
            <!-- New Header -->
            <div class="header">
                <div class="header-left">
                    <div class="breadcrumb">Pages / Dashboard</div>
                    <h1 class="page-title">Dashboard</h1>
                </div>
                <div class="header-right">
                    <input type="text" class="search-bar" placeholder="Type here...">
                    <div class="user-profile">
                        <div class="avatar">NA</div>
                        <span>Naresh</span>
                    </div>
                </div>
            </div>

            <!-- DASHBOARD PAGE -->
            <div id="page-dashboard" class="page-content">
                <div class="stats-grid">
                    <div class="material-card">
                        <div class="material-icon-box" style="background: linear-gradient(195deg, #66bb6a, #43a047);">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="material-stat-content">
                            <div class="material-stat-label">Total DM Sources</div>
                            <div class="material-stat-value" id="total-dm-sources">0</div>
                        </div>
                        <div class="material-stat-footer">
                            <span class="trend-up">‚Üë 5%</span> since last month
                        </div>
                    </div>

                    <div class="material-card">
                        <div class="material-icon-box" style="background: linear-gradient(195deg, #42a5f5, #2196f3);">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="material-stat-content">
                            <div class="material-stat-label">Total Data Sources</div>
                            <div class="material-stat-value" id="total-data-sources">0</div>
                        </div>
                        <div class="material-stat-footer">
                            <span class="trend-up">‚Üë 12%</span> since last week
                        </div>
                    </div>

                    <div class="material-card">
                        <div class="material-icon-box" style="background: linear-gradient(195deg, #ffa726, #fb8c00);">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="material-stat-content">
                            <div class="material-stat-label">Migrations Completed</div>
                            <div class="material-stat-value" id="migrations-completed">0</div>
                        </div>
                        <div class="material-stat-footer">
                            <span class="trend-up">‚Üë 8%</span> in last 24 hours
                        </div>
                    </div>

                    <div class="material-card">
                        <div class="material-icon-box" style="background: linear-gradient(195deg, #ef5350, #e53935);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="material-stat-content">
                            <div class="material-stat-label">Active Schedules</div>
                            <div class="material-stat-value" id="active-schedules">0</div>
                        </div>
                        <div class="material-stat-footer">
                            <span class="trend-down">‚Üì 2%</span> compared to yesterday
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-top: 0; margin-bottom: 20px;">Migration Trends</h3>
                    <div class="chart-container">
                        <canvas id="migrationTrendChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-top: 0; margin-bottom: 20px;">Recent Activity</h3>
                    <p>List of recent migrations, connection tests, and system events.</p>
                    <ul>
                        <li>Migration 'Salesforce to Snowflake' completed successfully.</li>
                        <li>New DM Source 'Production PostgreSQL' added.</li>
                        <li>Data Source 'SAP ECC' connection failed.</li>
                    </ul>
                </div>
            </div>

            <!-- SOURCE CONNECTIONS PAGE -->
            <div id="page-connections" class="page-content hidden">
                <div class="crud-header">
                    <h2 style="margin: 0;">üîå Data Source Connections</h2>
                    <button class="btn-primary" onclick="openDataModal('add')">+ Add Source</button>
                </div>

                <div class="card" style="padding: 0; overflow: hidden;">
                    <table class="crud-table">
                        <thead>
                            <tr>
                                <th>Source Name</th>
                                <th>Type</th>
                                <th>Endpoint / Host</th>
                                <th>Auth User</th>
                                <th>Status</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="data-connections-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- ADD/EDIT DATA SOURCE MODAL -->
                <div id="data-connection-modal" class="modal-overlay hidden">
                    <div class="modal-container">
                        <div class="modal-header">
                            <div class="modal-title" id="data-modal-title">Add Data Source</div>
                            <button class="close-modal" onclick="closeDataModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="data-conn-id">

                            <label>Source Name</label>
                            <input type="text" id="data-conn-name" placeholder="e.g., Global Salesforce CRM">

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Source Type</label>
                                    <select id="data-conn-type" onchange="toggleDataFields()">
                                        <option value="Salesforce">Salesforce</option>
                                        <option value="NetSuite">NetSuite</option>
                                        <option value="Epicor">Epicor</option>
                                        <option value="WebService">WebService (REST/SOAP)</option>
                                    </select>
                                </div>
                            </div>

                            <label id="lbl-data-host">Login URL / Host</label>
                            <input type="text" id="data-conn-host" placeholder="https://login.salesforce.com">

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Username / Client ID</label>
                                    <input type="text" id="data-conn-user" placeholder="User">
                                </div>
                                <div class="form-col">
                                    <label>Password / Secret</label>
                                    <input type="password" id="data-conn-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        style="padding: 10px 12px; width: 100%; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                </div>
                            </div>

                            <!-- Extra Fields based on Selection -->
                            <div id="data-extra-netsuite" class="hidden">
                                <label>Account ID / Realm</label>
                                <input type="text" id="data-conn-account" placeholder="1234567">
                                <label>Role ID</label>
                                <input type="text" id="data-conn-role" placeholder="1032">
                            </div>

                            <div id="data-extra-webservice" class="hidden">
                                <label>Auth Method</label>
                                <select id="data-conn-auth-method">
                                    <option>Basic Auth</option>
                                    <option>Bearer Token</option>
                                    <option>API Key</option>
                                    <option>OAuth 2.0</option>
                                </select>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="testDataConnection()">Test Connection</button>
                            <div style="flex: 1;"></div>
                            <button class="btn-secondary" onclick="closeDataModal()">Cancel</button>
                            <button class="btn-primary" onclick="saveDataConnection()">Save Source</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DM SOURCE PAGE -->
            <div id="page-dmsource" class="page-content hidden">
                <div class="crud-header">
                    <h2 style="margin: 0;">üì¶ DM Source Connection</h2>
                    <button class="btn-primary" onclick="openDMModal('add')">+ Add Connection</button>
                </div>

                <div class="card" style="padding: 0; overflow: hidden;">
                    <table class="crud-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Host / Account</th>
                                <th>Database</th>
                                <th>Status</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dm-connections-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- ADD/EDIT MODAL -->
                <div id="dm-connection-modal" class="modal-overlay hidden">
                    <div class="modal-container">
                        <div class="modal-header">
                            <div class="modal-title" id="modal-title">Add DM Source Connection</div>
                            <button class="close-modal" onclick="closeDMModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="dm-conn-id">

                            <label>Connection Name</label>
                            <input type="text" id="dm-conn-name" placeholder="e.g., Production Snowflake">

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Type</label>
                                    <select id="dm-conn-type" onchange="toggleDMFields()">
                                        <option value="snowflake">Snowflake</option>
                                        <option value="postgresql">PostgreSQL</option>
                                        <option value="mysql">MySQL</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label>Database</label>
                                    <input type="text" id="dm-conn-db" placeholder="Database Name">
                                </div>
                            </div>

                            <label id="lbl-host">Account URL / Host</label>
                            <input type="text" id="dm-conn-host"
                                placeholder="e.g., xy12345.us-east-1.snowflakecomputing.com">

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Username</label>
                                    <input type="text" id="dm-conn-user" placeholder="User">
                                </div>
                                <div class="form-col">
                                    <label>Password</label>
                                    <input type="password" id="dm-conn-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        style="padding: 10px 12px; width: 100%; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                </div>
                            </div>

                            <!-- Snowflake Specific -->
                            <div id="dm-extra-snowflake">
                                <label>Warehouse</label>
                                <input type="text" id="dm-conn-warehouse" placeholder="COMPUTE_WH">
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="testDMConnection()">Test Connection</button>
                            <div style="flex: 1;"></div>
                            <button class="btn-secondary" onclick="closeDMModal()">Cancel</button>
                            <button class="btn-primary" onclick="saveDMConnection()">Save Connection</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EXPORT MODAL -->
            <div id="export-modal" class="modal-overlay hidden">
                <div class="modal-container" style="max-width: 800px; width: 90%;">
                    <div class="modal-header">
                        <div class="modal-title">Export Functionality</div>
                        <button class="close-modal" onclick="closeExportModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="modal-tabs">
                            <div class="modal-tab active" onclick="switchExportTab('config')">Detailed Configuration
                            </div>
                            <div class="modal-tab" onclick="switchExportTab('job')">Databricks Workflow JSON</div>
                        </div>

                        <!-- TAB 1: Config -->
                        <div id="tab-config" class="tab-content active">
                            <div class="info-box" style="margin-bottom: 10px; padding: 10px;">
                                Internal configuration state related to this specific migration pipeline.
                            </div>
                            <div style="position: relative;">
                                <button class="copy-btn" onclick="copyExportJSON('json-config')">Copy JSON</button>
                                <div class="json-display" id="json-config">Loading...</div>
                            </div>
                        </div>

                        <!-- TAB 2: Job -->
                        <div id="tab-job" class="tab-content">
                            <div class="info-box" style="margin-bottom: 10px; padding: 10px;">
                                Ready-to-use <code>spark_jar_task</code> definition for Databricks Jobs API.
                            </div>
                            <div style="position: relative;">
                                <button class="copy-btn" onclick="copyExportJSON('json-job')">Copy JSON</button>
                                <div class="json-display" id="json-job">Loading...</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="flex: 1;"></div>
                        <button class="btn-primary" onclick="closeExportModal()">Close</button>
                    </div>
                </div>
            </div>

            <!-- LINEAGE MODAL -->
            <div id="lineage-modal" class="modal-overlay hidden">
                <div class="modal-container" style="max-width: 1000px; width: 95%; height: 80vh;">
                    <div class="modal-header">
                        <div class="modal-title">Data Lineage Visualization</div>
                        <button class="close-modal" onclick="closeLineageModal()">√ó</button>
                    </div>
                    <div class="modal-body" style="padding: 0; overflow: hidden; background: #f8fafc;">
                        <div id="lineage-container" style="width: 100%; height: 100%;">
                            <!-- Tooltip -->
                            <div id="lineage-tooltip"
                                style="position: absolute; opacity: 0; background: #1e293b; color: white; padding: 6px 12px; border-radius: 4px; font-size: 12px; pointer-events: none; z-index: 10;">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="font-size: 12px; color: #64748b;">
                            <span
                                style="display:inline-block; width:10px; height:10px; background:#10b981; border-radius:50%; margin-right:4px;"></span>
                            Verified Mapping
                            <span
                                style="display:inline-block; width:10px; height:10px; background:#cbd5e1; border-radius:50%; margin-left:12px; margin-right:4px;"></span>
                            Unmapped
                        </div>
                        <div style="flex: 1;"></div>
                        <button class="btn-secondary" onclick="exportLineageSVG()">Download SVG</button>
                        <button class="btn-primary" onclick="closeLineageModal()">Close</button>
                    </div>
                </div>
            </div>

            <!-- DATA WAREHOUSE PAGE -->
            <div id="page-warehouse" class="page-content hidden">
                <h2 style="margin-bottom: 20px;">üè™ Data Warehouse</h2>
                <div class="card">
                    <h3>Warehouse Management</h3>
                    <p>Data warehouse tables, schemas, and management tools would display here.</p>
                </div>
            </div>

            <!-- DATA MARTS PAGE -->
            <div id="page-datamarts" class="page-content hidden">
                <h2 style="margin-bottom: 20px;">üì¶ Data Marts</h2>
                <div class="card">
                    <h3>Available Data Marts</h3>
                    <p>List of all data marts with their configurations and status would appear here.</p>
                </div>
            </div>

            <!-- SCHEDULES PAGE -->
            <div id="page-schedules" class="page-content hidden">
                <h2 style="margin-bottom: 20px;">‚è∞ Schedules</h2>
                <div class="card">
                    <h3>Job Schedules</h3>
                    <p>Scheduled jobs, cron expressions, and execution history would display here.</p>
                </div>
            </div>

            <!-- MONITORING PAGE -->
            <div id="page-monitoring" class="page-content hidden">
                <h2 style="margin-bottom: 20px;">üìà Monitoring</h2>
                <div class="card">
                    <h3>System Monitoring</h3>
                    <p>Real-time monitoring, logs, alerts, and performance metrics would appear here.</p>
                </div>
            </div>

            <!-- MIGRATION PORTAL PAGE (MAIN) -->
            <div id="page-migration" class="page-content hidden">

                <!-- MODE SELECTION -->
                <div class="mode-selector">
                    <div class="mode-card selected" onclick="selectMode('mapping')">
                        <div class="mode-icon">üó∫Ô∏è</div>
                        <div class="mode-title">DM-to-Source Mapping</div>
                        <div class="mode-desc">
                            Map existing Data Mart table columns back to their source system origins for lineage and
                            governance
                        </div>
                    </div>

                    <div class="mode-card" onclick="selectMode('tenant')">
                        <div class="mode-icon">üîÑ</div>
                        <div class="mode-title">Tenant-to-Tenant Migration</div>
                        <div class="mode-desc">
                            Migrate complete pipelines, data marts, and configurations from one tenant/environment to
                            another
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- TENANT MIGRATION WORKFLOW -->
                <!-- ============================================ -->
                <div id="tenant-migration" class="hidden">

                    <!-- WIZARD STEPPER -->
                    <div class="stepper-wrapper">
                        <div class="stepper-item active" id="stepper-1">
                            <div class="step-counter">1</div>
                            <div class="step-name">Source Tenant</div>
                        </div>
                        <div class="stepper-item" id="stepper-2">
                            <div class="step-counter">2</div>
                            <div class="step-name">Target Tenant</div>
                        </div>
                        <div class="stepper-item" id="stepper-3">
                            <div class="step-counter">3</div>
                            <div class="step-name">Select Pipelines</div>
                        </div>
                        <div class="stepper-item" id="stepper-4">
                            <div class="step-counter">4</div>
                            <div class="step-name">Options</div>
                        </div>
                        <div class="stepper-item" id="stepper-5">
                            <div class="step-counter">5</div>
                            <div class="step-name">Review & Execute</div>
                        </div>
                    </div>

                    <!-- STEP 1: Source Tenant -->
                    <div class="wizard-step active" id="step-1">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">1</span>
                                Source Tenant Configuration
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Source Tenant</label>
                                    <select>
                                        <option>Production (prod.anvizent.com)</option>
                                        <option>Staging (staging.anvizent.com)</option>
                                        <option>Development (dev.anvizent.com)</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label>Source Environment</label>
                                    <select>
                                        <option>Databricks - US East</option>
                                        <option>Databricks - EU West</option>
                                        <option>Snowflake - US West</option>
                                    </select>
                                </div>
                            </div>

                            <label>Authentication</label>
                            <input type="text" placeholder="API Key or Service Principal">
                        </div>
                    </div>

                    <!-- STEP 2: Target Tenant -->
                    <div class="wizard-step" id="step-2">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">2</span>
                                Target Tenant Configuration
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Target Tenant</label>
                                    <select>
                                        <option>Development (dev.anvizent.com)</option>
                                        <option>Staging (staging.anvizent.com)</option>
                                        <option>Production (prod.anvizent.com)</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label>Target Environment</label>
                                    <select>
                                        <option>Databricks - US East</option>
                                        <option>Databricks - EU West</option>
                                        <option>Snowflake - US West</option>
                                    </select>
                                </div>
                            </div>

                            <label>Authentication</label>
                            <input type="text" placeholder="API Key or Service Principal">
                        </div>
                    </div>

                    <!-- STEP 3: Pipeline Selection -->
                    <div class="wizard-step" id="step-3">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">3</span>
                                Select Pipelines to Migrate
                            </div>

                            <div class="info-box">
                                üí° Select one or more pipelines to migrate. Dependencies will be automatically
                                identified.
                            </div>

                            <table class="mapping-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"><input type="checkbox"></th>
                                        <th>Pipeline Name</th>
                                        <th>Type</th>
                                        <th>Source Tables</th>
                                        <th>Target DM</th>
                                        <th>Dependencies</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="checkbox" checked></td>
                                        <td>customer_360_pipeline</td>
                                        <td><span class="badge">Data Mart</span></td>
                                        <td>dw_sales.customers, dw_sales.orders</td>
                                        <td>dm_sales.customer_summary</td>
                                        <td>2 upstream</td>
                                    </tr>
                                    <tr>
                                        <td><input type="checkbox"></td>
                                        <td>sales_aggregation</td>
                                        <td><span class="badge">Data Mart</span></td>
                                        <td>dw_sales.transactions</td>
                                        <td>dm_sales.daily_sales</td>
                                        <td>None</td>
                                    </tr>
                                    <tr>
                                        <td><input type="checkbox"></td>
                                        <td>marketing_funnel</td>
                                        <td><span class="badge">Data Mart</span></td>
                                        <td>dw_marketing.campaigns, dw_marketing.leads</td>
                                        <td>dm_marketing.funnel_metrics</td>
                                        <td>1 upstream</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- STEP 4: Migration Options -->
                    <div class="wizard-step" id="step-4">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">4</span>
                                Migration Options
                            </div>

                            <div class="radio-group">
                                <input type="radio" name="migMode" id="config-only" value="config" checked>
                                <label for="config-only">Configuration Only (DDL, SQL, schedules - no data)</label>
                            </div>

                            <div class="radio-group">
                                <input type="radio" name="migMode" id="config-data" value="both">
                                <label for="config-data">Configuration + Data Migration (Full copy)</label>
                            </div>

                            <div class="radio-group">
                                <input type="radio" name="migMode" id="schema-only" value="schema">
                                <label for="schema-only">Schema/Structure Only (Empty tables with DDL)</label>
                            </div>

                            <div style="margin-top: 20px;">
                                <input type="checkbox" id="include-schedules">
                                <label for="include-schedules" style="display: inline; margin-left: 8px;">Include Job
                                    Schedules</label>
                            </div>

                            <div>
                                <input type="checkbox" id="include-connections">
                                <label for="include-connections" style="display: inline; margin-left: 8px;">Migrate
                                    Source Connections</label>
                            </div>

                            <div>
                                <input type="checkbox" id="remap-paths" checked>
                                <label for="remap-paths" style="display: inline; margin-left: 8px;">Auto-remap
                                    catalog/schema paths for target</label>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 5: Review & Execute -->
                    <div class="wizard-step" id="step-5">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">5</span>
                                Review & Execute Migration
                            </div>

                            <div class="info-box">
                                üöÄ Ready to migrate! Review your configuration below before executing.
                            </div>

                            <!-- Summary Section -->
                            <div
                                style="background: #f8fafc; padding: 16px; border-radius: 6px; border: 1px solid #e2e8f0; margin-bottom: 24px;">
                                <p><strong>Source:</strong> Production (prod.anvizent.com)</p>
                                <p><strong>Target:</strong> Development (dev.anvizent.com)</p>
                                <p><strong>Pipelines:</strong> 1 selected (customer_360_pipeline)</p>
                                <p><strong>Mode:</strong> Configuration Only</p>
                            </div>


                            <!-- Execution Mode Selection -->
                            <div style="margin-bottom: 24px;">
                                <label
                                    style="font-size: 15px; font-weight: 600; margin-bottom: 12px; display: block;">Execution
                                    Mode</label>

                                <div class="toggle-container">
                                    <span class="toggle-label active" id="label-run-now">‚ñ∂Ô∏è Run Now</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="exec-mode-toggle" onchange="toggleScheduleOptions()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="label-schedule">‚è∞ Schedule for Later</span>
                                </div>
                            </div>

                            <!-- Schedule Options (Hidden by default) -->
                            <div id="schedule-options" class="hidden"
                                style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 24px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600; color: #1e293b;">
                                    Schedule Configuration</h4>

                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Frequency</label>
                                        <select id="schedule-frequency" style="max-width: 100%;">
                                            <option value="once">One-time execution</option>
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Timezone</label>
                                        <select id="schedule-timezone" style="max-width: 100%;">
                                            <option value="UTC">UTC</option>
                                            <option value="America/New_York">Eastern Time (ET)</option>
                                            <option value="America/Chicago">Central Time (CT)</option>
                                            <option value="America/Denver">Mountain Time (MT)</option>
                                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                            <option value="Europe/London">London (GMT)</option>
                                            <option value="Asia/Kolkata">India (IST)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Start Date</label>
                                        <input type="date" id="schedule-date" style="max-width: 100%;">
                                    </div>
                                    <div class="form-col">
                                        <label>Start Time</label>
                                        <input type="time" id="schedule-time" style="max-width: 100%;">
                                    </div>
                                </div>

                                <div>
                                    <input type="checkbox" id="schedule-notify">
                                    <label for="schedule-notify" style="display: inline; margin-left: 8px;">Send
                                        notification on completion</label>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="action-bar">
                                <div>
                                    <button class="btn-secondary">‚ñ∂Ô∏è Preview Changes</button>
                                </div>
                                <div style="display: flex; gap: 12px;">
                                    <button class="btn-secondary">üíæ Save as Template</button>
                                    <button class="btn-secondary">üìã Export Plan</button>
                                    <button class="btn-primary" id="execute-btn" onclick="executeMigration()">üöÄ Execute
                                        Now</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- WIZARD FOOTER NAVIGATION -->
                    <div class="wizard-footer">
                        <button class="btn-secondary" id="btn-back" onclick="changeStep(-1)" disabled>‚Üê Back</button>
                        <button class="btn-primary" id="btn-next" onclick="changeStep(1)">Next Step ‚Üí</button>
                    </div>

                </div>

                <!-- ============================================ -->
                <!-- DM-TO-SOURCE MAPPING WORKFLOW -->
                <!-- ============================================ -->
                <div id="dm-mapping">

                    <!-- DM WIZARD STEPPER -->
                    <div class="stepper-wrapper">
                        <div class="stepper-item active" id="dm-stepper-1">
                            <div class="step-counter">1</div>
                            <div class="step-name">Target Selection</div>
                        </div>
                        <div class="stepper-item" id="dm-stepper-2">
                            <div class="step-counter">2</div>
                            <div class="step-name">Source Selection</div>
                        </div>
                        <div class="stepper-item" id="dm-stepper-3">
                            <div class="step-counter">3</div>
                            <div class="step-name">Column Mapping</div>
                        </div>
                        <div class="stepper-item" id="dm-stepper-4">
                            <div class="step-counter">4</div>
                            <div class="step-name">Configuration</div>
                        </div>
                        <div class="stepper-item" id="dm-stepper-5">
                            <div class="step-counter">5</div>
                            <div class="step-name">Review & Execute</div>
                        </div>
                    </div>

                    <!-- STEP 1: Target & Table Selection -->
                    <div class="wizard-step active" id="dm-step-1">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">1</span>
                                Target & Table Selection
                            </div>

                            <label>Target Connection</label>
                            <select id="dm-target-connection" style="max-width: 600px; margin-bottom: 16px;"
                                onchange="handleTargetConnectionChange()">
                                <option value="">-- Select Target Database --</option>
                                <option value="snowflake">Snowflake</option>
                                <option value="postgresql">PostgreSQL</option>
                                <option value="mysql">MySQL</option>
                            </select>

                            <!-- Default / Databricks Form (Default Hidden if Connection selected) -->
                            <div id="target-form-default" class="connection-form hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Catalog</label>
                                        <select id="dm-catalog">
                                            <option>main</option>
                                            <option>analytics</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Schema</label>
                                        <select id="dm-schema">
                                            <option>dm_sales</option>
                                            <option>dm_marketing</option>
                                            <option>dm_finance</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Snowflake Form -->
                            <div id="target-form-snowflake" class="connection-form hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Warehouse</label>
                                        <select id="sf-warehouse">
                                            <option>COMPUTE_WH</option>
                                            <option>ANALYTICS_WH</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Database</label>
                                        <select id="sf-database">
                                            <option>SALES_DB</option>
                                            <option>MARKETING_DB</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Schema</label>
                                        <select id="sf-schema">
                                            <option>PUBLIC</option>
                                            <option>DM_SALES</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- PostgreSQL / MySQL Form -->
                            <div id="target-form-sql" class="connection-form hidden">
                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Database</label>
                                        <select id="sql-database">
                                            <option>production_db</option>
                                            <option>analytics_db</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Schema</label>
                                        <select id="sql-schema">
                                            <option>public</option>
                                            <option>sales</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <label>Target Table</label>
                            <select id="dm-table" style="max-width: 600px;">
                                <option>customer_summary</option>
                                <option>daily_sales_metrics</option>
                                <option>product_performance</option>
                            </select>

                            <button class="btn-primary" style="margin-top: 16px;" onclick="loadDMColumns()">
                                üîç Load Table Schema
                            </button>
                        </div>
                    </div>

                    <!-- STEP 2: Source System Selection -->
                    <div class="wizard-step" id="dm-step-2">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">2</span>
                                Source System Selection
                            </div>

                            <div class="info-box">
                                üí° Select the source ERP/Application and one or more tables/objects.
                            </div>

                            <div class="form-row">
                                <div class="form-col">
                                    <label>Source System (ERP/CRM)</label>
                                    <select id="global-source-system" onchange="loadSourceTables()">
                                        <option value="">-- Select Source System --</option>
                                        <option>SAP S/4HANA</option>
                                        <option>Oracle EBS</option>
                                        <option>Microsoft Dynamics 365</option>
                                        <option>Salesforce</option>
                                        <option>NetSuite</option>
                                        <option>Workday</option>
                                    </select>
                                </div>
                            </div>

                            <label>Source Tables/Objects (Select Multiple)</label>
                            <div style="margin-bottom: 16px;">
                                <select id="table-selector" style="max-width: 600px;" onchange="addSourceTable()">
                                    <option value="">-- Add Table/Object --</option>
                                    <option value="Account">Account</option>
                                    <option value="Contact">Contact</option>
                                    <option value="Opportunity">Opportunity</option>
                                    <option value="OpportunityLineItem">OpportunityLineItem</option>
                                    <option value="Order">Order</option>
                                    <option value="OrderItem">OrderItem</option>
                                    <option value="Lead">Lead</option>
                                    <option value="Campaign">Campaign</option>
                                    <option value="Product2">Product2</option>
                                </select>
                            </div>

                            <div id="selected-tables" class="selected-tables-container">
                                <!-- Selected tables will appear here as tags -->
                            </div>

                            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                                <label>Quick Actions</label><br>
                                <button class="btn-primary" onclick="autoMapColumns()" style="margin-top: 8px;">
                                    üîó Auto-Map Matching Column Names
                                </button>
                                <button class="btn-secondary" onclick="clearAllMappings()" style="margin-top: 8px;">
                                    üóëÔ∏è Clear All Mappings
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 3: Column Mapping -->
                    <div class="wizard-step" id="dm-step-3">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">3</span>
                                Column-Level Mapping
                            </div>

                            <div class="info-box">
                                üí° Map each DM column to its source column. Override source system/table if a column
                                comes from a different source.
                            </div>

                            <table class="mapping-table">
                                <thead>
                                    <tr>
                                        <th style="width: 180px;">DM Column</th>
                                        <th style="width: 90px;">Data Type</th>
                                        <th style="width: 180px;">Source Table</th>
                                        <th style="width: 180px;">Source Column</th>
                                        <th style="width: 220px;">Transformation/Logic</th>
                                        <th style="width: 60px;">
                                            <button class="btn-secondary" style="padding: 4px 8px; font-size: 11px;"
                                                onclick="toggleAllOverrides()">
                                                ‚öôÔ∏è
                                            </button>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="mapping-rows">
                                    <tr>
                                        <td><strong>customer_id</strong></td>
                                        <td>STRING</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account" selected>Account</option>
                                                <option value="Contact">Contact</option>
                                                <option value="Opportunity">Opportunity</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option>-- Select Column --</option>
                                                <option selected>Id</option>
                                                <option>AccountNumber</option>
                                                <option>ExternalId</option>
                                                <option>CustomerId__c</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" placeholder="e.g., UPPER(Id)" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>customer_name</strong></td>
                                        <td>STRING</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account" selected>Account</option>
                                                <option value="Contact">Contact</option>
                                                <option value="Opportunity">Opportunity</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option>-- Select Column --</option>
                                                <option selected>Name</option>
                                                <option>CompanyName</option>
                                                <option>AccountName</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" placeholder="e.g., TRIM(Name)" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>total_orders</strong></td>
                                        <td>INTEGER</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account">Account</option>
                                                <option value="Contact">Contact</option>
                                                <option value="Opportunity" selected>Opportunity</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option selected>-- Calculated Field --</option>
                                                <option>OrderCount</option>
                                                <option>NumOrders__c</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" value="COUNT(DISTINCT Id)" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>total_revenue</strong></td>
                                        <td>DECIMAL</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account">Account</option>
                                                <option value="Opportunity" selected>Opportunity</option>
                                                <option value="OpportunityLineItem">OpportunityLineItem</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option>-- Calculated Field --</option>
                                                <option selected>Amount</option>
                                                <option>TotalPrice</option>
                                                <option>Revenue__c</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" value="SUM(Amount)" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>last_order_date</strong></td>
                                        <td>DATE</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account">Account</option>
                                                <option value="Opportunity" selected>Opportunity</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option>-- Select Column --</option>
                                                <option selected>CloseDate</option>
                                                <option>CreatedDate</option>
                                                <option>LastModifiedDate</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" value="MAX(CloseDate)" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>contact_email</strong></td>
                                        <td>STRING</td>
                                        <td>
                                            <select class="source-table-select" style="max-width: 100%;">
                                                <option value="">-- Select Table --</option>
                                                <option value="Account">Account</option>
                                                <option value="Contact" selected>Contact</option>
                                                <option value="Opportunity">Opportunity</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select style="max-width: 100%;">
                                                <option>-- Select Column --</option>
                                                <option selected>Email</option>
                                                <option>PrimaryEmail__c</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" placeholder="Optional" style="max-width: 100%;">
                                        </td>
                                        <td style="text-align: center;">
                                            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px;"
                                                onclick="showAdvancedOptions(this)" title="Advanced options">
                                                ‚ãÆ
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <button class="add-row-btn" onclick="addMappingRow()">+ Add Column Mapping</button>
                        </div>
                    </div>

                    <!-- STEP 4: Mapping Configuration -->
                    <div class="wizard-step" id="dm-step-4">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">4</span>
                                Mapping Configuration
                            </div>



                            <label>Mapping Purpose</label>
                            <select>
                                <option>Data Lineage & Governance</option>
                                <option>Reverse ETL Setup</option>
                                <option>Source System Validation</option>
                                <option>Documentation Only</option>
                            </select>

                            <label style="margin-top: 20px;">Load Strategy</label>
                            <div class="strategy-grid">
                                <!-- Option 1: Append -->
                                <div class="strategy-card selected" onclick="selectLoadStrategy('append', this)">
                                    <div class="strategy-icon"><i class="fas fa-plus-circle"></i></div>
                                    <div class="strategy-title">Append Only (Insert)</div>
                                    <div class="strategy-desc">Adds new records. May result in duplicates if keys exist.
                                        Fast load.</div>
                                    <input type="radio" name="loadStrat" value="append" checked style="display:none;">
                                </div>

                                <!-- Option 2: Merge -->
                                <div class="strategy-card" onclick="selectLoadStrategy('merge', this)">
                                    <div class="strategy-icon"><i class="fas fa-code-branch"></i></div>
                                    <div class="strategy-title">Merge (Upsert)</div>
                                    <div class="strategy-desc">Updates existing records based on keys, inserts new ones.
                                        Slower but idempotent.</div>
                                    <input type="radio" name="loadStrat" value="merge" style="display:none;">
                                </div>

                                <!-- Option 3: Truncate -->
                                <div class="strategy-card" onclick="selectLoadStrategy('truncate', this)">
                                    <div class="strategy-icon"><i class="fas fa-eraser"></i></div>
                                    <div class="strategy-title">Truncate & Load</div>
                                    <div class="strategy-desc">Clears target table completely before loading. Best for
                                        full refreshing snapshots.</div>
                                    <input type="radio" name="loadStrat" value="truncate" style="display:none;">
                                </div>

                                <!-- Option 4: Reverse Engineering -->
                                <div class="strategy-card" onclick="selectLoadStrategy('reverse', this)">
                                    <div class="strategy-icon"><i class="fas fa-microchip"></i></div>
                                    <div class="strategy-title">Reverse Engineering</div>
                                    <div class="strategy-desc">Metadata only. Captures structure/keys without moving
                                        data.</div>
                                    <input type="radio" name="loadStrat" value="reverse" style="display:none;">
                                </div>
                            </div>

                            <!-- Reverse Engineering Rules -->
                            <div id="reverse-engineering-options" class="hidden">
                                <div class="rules-container">
                                    <label style="margin-top:0; color:#1e293b;">üõ†Ô∏è Reverse Engineering Rules</label>
                                    <div
                                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 10px;">
                                        <div>
                                            <input type="checkbox" id="rule-infer-rel" checked>
                                            <label for="rule-infer-rel"
                                                style="display:inline; margin-left:8px; font-weight:400;">Infer
                                                Relationships (FK)</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="rule-use-keys" checked>
                                            <label for="rule-use-keys"
                                                style="display:inline; margin-left:8px; font-weight:400;">Use Existing
                                                Keys</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="rule-detect-types">
                                            <label for="rule-detect-types"
                                                style="display:inline; margin-left:8px; font-weight:400;">Auto-Detect
                                                Data Types</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="rule-sample-data">
                                            <label for="rule-sample-data"
                                                style="display:inline; margin-left:8px; font-weight:400;">Profile Sample
                                                Data</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Auto Detect (Legacy / Alternative) -->
                            <div class="radio-group" style="margin-top: 20px;">
                                <input type="checkbox" id="auto-detect-sql">
                                <label for="auto-detect-sql" style="display: inline; margin-left: 8px;">
                                    Analyze existing pipeline SQL to auto-suggest strategy
                                </label>
                            </div>

                            <div style="margin-top: 20px;">
                                <input type="checkbox" id="validate-sources" checked>
                                <label for="validate-sources" style="display: inline; margin-left: 8px;">Validate source
                                    columns exist</label>
                            </div>

                            <div>
                                <input type="checkbox" id="track-lineage" checked>
                                <label for="track-lineage" style="display: inline; margin-left: 8px;">Enable lineage
                                    tracking in metadata catalog</label>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 5: Review & Execute -->
                    <div class="wizard-step" id="dm-step-5">
                        <div class="card">
                            <div class="section-title">
                                <span class="step-badge">5</span>
                                Review & Execute Mapping
                            </div>

                            <div class="info-box">
                                üí° Review your configuration below. Click "Validate" to check for errors before
                                executing.
                            </div>

                            <!-- CONFIGURATION SUMMARY -->
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <div class="summary-label">Target Table</div>
                                    <div class="summary-value" id="summary-target">Loading...</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Source System</div>
                                    <div class="summary-value" id="summary-source">Loading...</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Load Strategy</div>
                                    <div class="summary-value" id="summary-strategy">Loading...</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Mapped Columns</div>
                                    <div class="summary-value" id="summary-cols">0</div>
                                </div>
                            </div>

                            <!-- VALIDATION STATUS -->
                            <div id="validation-box" class="validation-box pending">
                                <div class="validation-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="validation-content">
                                    <div class="validation-title" id="val-title">Ready to Validate</div>
                                    <div class="validation-desc" id="val-desc">Click "Validate Configuration" to check
                                        connection, mappings, and data types.</div>
                                </div>
                                <button class="btn-primary" onclick="validateConfiguration()"
                                    id="btn-validate-action">Validate Configuration</button>
                            </div>

                            <!-- Execution Mode Selection -->
                            <div style="margin: 24px 0;">
                                <label
                                    style="font-size: 15px; font-weight: 600; margin-bottom: 12px; display: block;">Execution
                                    Mode</label>

                                <div class="toggle-container">
                                    <span class="toggle-label active" id="dm-label-run-now">‚ñ∂Ô∏è Run Now</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="dm-exec-mode-toggle"
                                            onchange="toggleDMScheduleOptions()">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="dm-label-schedule">‚è∞ Schedule for Later</span>
                                </div>
                            </div>

                            <!-- Schedule Options (Hidden by default) -->
                            <div id="dm-schedule-options" class="hidden"
                                style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 24px;">
                                <h4 style="margin: 0 0 16px 0; font-size: 14px; font-weight: 600; color: #1e293b;">
                                    Schedule Configuration</h4>

                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Frequency</label>
                                        <select id="dm-schedule-frequency" style="max-width: 100%;">
                                            <option value="once">One-time execution</option>
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label>Timezone</label>
                                        <select id="dm-schedule-timezone" style="max-width: 100%;">
                                            <option value="UTC">UTC</option>
                                            <option value="America/New_York">Eastern Time (ET)</option>
                                            <option value="America/Chicago">Central Time (CT)</option>
                                            <option value="America/Denver">Mountain Time (MT)</option>
                                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                            <option value="Europe/London">London (GMT)</option>
                                            <option value="Asia/Kolkata">India (IST)</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-col">
                                        <label>Start Date</label>
                                        <input type="date" id="dm-schedule-date" style="max-width: 100%;">
                                    </div>
                                    <div class="form-col">
                                        <label>Start Time</label>
                                        <input type="time" id="dm-schedule-time" style="max-width: 100%;">
                                    </div>
                                </div>

                                <div>
                                    <input type="checkbox" id="dm-schedule-notify">
                                    <label for="dm-schedule-notify" style="display: inline; margin-left: 8px;">Send
                                        notification on completion</label>
                                </div>
                            </div>

                            <!-- ACTIONS -->
                            <h4 style="margin: 0 0 16px 0; color: #334155;">Final Actions</h4>
                            <div class="action-grid">
                                <div class="action-card">
                                    <h4>Execute Mapping</h4>
                                    <p>Save to metadata catalog and execute the mapping pipeline.</p>
                                    <button class="btn-primary" onclick="executeDMMapping()" id="dm-execute-btn"
                                        disabled>üöÄ Execute Now</button>
                                </div>
                                <div class="action-card">
                                    <h4>Export & Documentation</h4>
                                    <p>Download configuration as JSON or generate lineage diagram.</p>
                                    <div style="display: flex; gap: 10px; justify-content: center;">
                                        <button class="btn-secondary" onclick="openExportModal()">üì§ Export
                                            JSON</button>
                                        <button class="btn-secondary" onclick="openLineageModal()">üìä Lineage</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- DM WIZARD FOOTER NAVIGATION -->
                    <div class="wizard-footer">
                        <button class="btn-secondary" id="dm-btn-back" onclick="changeDMStep(-1)" disabled>‚Üê
                            Back</button>
                        <button class="btn-primary" id="dm-btn-next" onclick="changeDMStep(1)">Next Step ‚Üí</button>
                    </div>

                </div>



            </div>


        </div>
        <!-- END MIGRATION PORTAL PAGE -->

    </div>
    </div>

    <script>
        // Track selected tables
        let selectedTables = [];

        function navigateTo(section, event) {
            event.preventDefault();

            // Update active state in sidebar
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });

            // Show selected page
            const pageId = 'page-' + section;
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
        }

        function selectMode(mode) {
            // Update mode cards
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selected class to the clicked card
            // Card [0] is DM-to-Source Mapping, Card [1] is Tenant-to-Tenant Migration
            if (mode === 'tenant') {
                document.querySelectorAll('.mode-card')[1].classList.add('selected');
            } else {
                document.querySelectorAll('.mode-card')[0].classList.add('selected');
            }

            // Show/hide sections
            if (mode === 'tenant') {
                document.getElementById('tenant-migration').classList.remove('hidden');
                document.getElementById('dm-mapping').classList.add('hidden');
            } else {
                document.getElementById('tenant-migration').classList.add('hidden');
                document.getElementById('dm-mapping').classList.remove('hidden');
            }
        }

        function handleTargetConnectionChange() {
            const connection = document.getElementById('dm-target-connection').value;

            // Hide all forms
            document.querySelectorAll('.connection-form').forEach(el => el.classList.add('hidden'));

            // Show specific form based on selection
            if (connection === 'snowflake') {
                document.getElementById('target-form-snowflake').classList.remove('hidden');
            } else if (connection === 'postgresql' || connection === 'mysql') {
                document.getElementById('target-form-sql').classList.remove('hidden');
            } else if (connection === '') {
                // Show nothing or default if needed
            } else {
                document.getElementById('target-form-default').classList.remove('hidden');
            }
        }

        function loadDMColumns() {
            const targetConnection = document.getElementById('dm-target-connection').value;
            let details = '';

            if (!targetConnection) {
                alert('Please select a Target Connection.');
                return;
            }

            if (targetConnection === 'snowflake') {
                const wh = document.getElementById('sf-warehouse').value;
                const db = document.getElementById('sf-database').value;
                const schema = document.getElementById('sf-schema').value;
                details = `Warehouse: ${wh}\nDatabase: ${db}\nSchema: ${schema}`;
            } else if (targetConnection === 'postgresql' || targetConnection === 'mysql') {
                const db = document.getElementById('sql-database').value;
                const schema = document.getElementById('sql-schema').value;
                details = `Database: ${db}\nSchema: ${schema}`;
            } else {
                const catalog = document.getElementById('dm-catalog').value;
                const schema = document.getElementById('dm-schema').value;
                details = `Catalog: ${catalog}\nSchema: ${schema}`;
            }

            const table = document.getElementById('dm-table').value;
            alert(`Loading table schema from ${targetConnection.toUpperCase()}...\n\n${details}\nTable: ${table}`);
        }

        function loadSourceTables() {
            const sourceSystem = document.getElementById('global-source-system').value;
            if (sourceSystem) {
                // Clear selected tables when source system changes
                selectedTables = [];
                updateSelectedTablesDisplay();
                alert(`Loading tables from ${sourceSystem}...`);
            }
        }

        function addSourceTable() {
            const selector = document.getElementById('table-selector');
            const tableName = selector.value;

            if (!tableName) return;

            // Check if already selected
            if (selectedTables.includes(tableName)) {
                alert(`Table "${tableName}" is already selected.`);
                selector.selectedIndex = 0;
                return;
            }

            // Add to selected tables
            selectedTables.push(tableName);
            updateSelectedTablesDisplay();
            updateTableDropdowns();

            // Reset selector
            selector.selectedIndex = 0;
        }

        function updateSelectedTablesDisplay() {
            const container = document.getElementById('selected-tables');
            container.innerHTML = '';

            selectedTables.forEach(tableName => {
                const tag = document.createElement('div');
                tag.className = 'table-tag';
                tag.innerHTML = `
                <span>${tableName}</span>
                <span class="remove-tag" onclick="removeSourceTable('${tableName}')">‚úï</span>
            `;
                container.appendChild(tag);
            });
        }

        function removeSourceTable(tableName) {
            selectedTables = selectedTables.filter(t => t !== tableName);
            updateSelectedTablesDisplay();
            updateTableDropdowns();
        }

        function updateTableDropdowns() {
            // Update all source table dropdowns in the mapping table
            const dropdowns = document.querySelectorAll('.source-table-select');
            dropdowns.forEach(dropdown => {
                const currentValue = dropdown.value;
                dropdown.innerHTML = '<option value="">-- Select Table --</option>';

                selectedTables.forEach(tableName => {
                    const option = document.createElement('option');
                    option.value = tableName;
                    option.textContent = tableName;
                    if (tableName === currentValue) {
                        option.selected = true;
                    }
                    dropdown.appendChild(option);
                });
            });
        }

        function addMappingRow() {
            const tbody = document.getElementById('mapping-rows');
            const newRow = tbody.rows[0].cloneNode(true);

            // Clear input values
            newRow.querySelectorAll('input[type="text"]').forEach(input => {
                input.value = '';
            });

            // Reset select to first option
            newRow.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });

            // Update the source table dropdown
            const sourceTableSelect = newRow.querySelector('.source-table-select');
            sourceTableSelect.innerHTML = '<option value="">-- Select Table --</option>';
            selectedTables.forEach(tableName => {
                const option = document.createElement('option');
                option.value = tableName;
                option.textContent = tableName;
                sourceTableSelect.appendChild(option);
            });

            tbody.appendChild(newRow);
        }

        function autoMapColumns() {
            const sourceSystem = document.getElementById('global-source-system').value;

            if (!sourceSystem) {
                alert('Please select a Source System first.');
                return;
            }

            if (selectedTables.length === 0) {
                alert('Please select at least one source table.');
                return;
            }

            alert(`üîó Auto-mapping columns...\n\nThis would attempt to automatically map DM columns to source columns by:\n‚Ä¢ Matching column names\n‚Ä¢ Detecting common naming patterns\n‚Ä¢ Using metadata from ${sourceSystem}`);
        }

        function clearAllMappings() {
            if (confirm('Are you sure you want to clear all column mappings?')) {
                // Clear all source column selects and transformation inputs
                document.querySelectorAll('#mapping-rows tr').forEach(row => {
                    const sourceColSelect = row.querySelectorAll('select')[1]; // Second select is source column
                    const transformInput = row.querySelector('input[type="text"]');

                    if (sourceColSelect) sourceColSelect.selectedIndex = 0;
                    if (transformInput) transformInput.value = '';
                });

                alert('‚úì All mappings cleared.');
            }
        }

        function showAdvancedOptions(button) {
            const row = button.closest('tr');
            const columnName = row.cells[0].textContent.trim();

            const options = [
                '1. Set different source system',
                '2. Configure data quality rules',
                '3. Add column-level notes',
                '4. Set sensitivity/PII flag',
                '5. Configure lineage tracking',
                '6. Delete this mapping'
            ].join('\n');

            const choice = prompt(`Advanced options for column: ${columnName}\n\n${options}\n\nEnter option number (1-6):`);

            if (choice === '1') {
                const newSystem = prompt('Enter different source system for this column:', 'SAP ERP');
                if (newSystem) alert(`‚úì Source system override: ${newSystem}`);
            } else if (choice === '6') {
                if (confirm(`Delete mapping for ${columnName}?`)) {
                    row.remove();
                }
            } else if (choice) {
                alert('This feature would open a detailed configuration panel.');
            }
        }

        function toggleAllOverrides() {
            alert('This would toggle advanced mode showing/hiding additional configuration columns like:\n‚Ä¢ Data quality rules\n‚Ä¢ PII/Sensitivity flags\n‚Ä¢ Lineage tracking\n‚Ä¢ Source system overrides');
        }

        // --- SCHEDULE & EXECUTION LOGIC ---

        function toggleScheduleOptions() {
            const toggle = document.getElementById('exec-mode-toggle');
            const scheduleOptions = document.getElementById('schedule-options');
            const executeBtn = document.getElementById('execute-btn');
            const labelRunNow = document.getElementById('label-run-now');
            const labelSchedule = document.getElementById('label-schedule');

            if (toggle && toggle.checked) {
                // Schedule for Later is selected
                scheduleOptions.classList.remove('hidden');
                if (executeBtn) {
                    executeBtn.innerHTML = 'üìÖ Schedule Migration';
                }
                labelRunNow.classList.remove('active');
                labelSchedule.classList.add('active');
            } else {
                // Run Now is selected
                scheduleOptions.classList.add('hidden');
                if (executeBtn) {
                    executeBtn.innerHTML = 'üöÄ Execute Now';
                }
                labelRunNow.classList.add('active');
                labelSchedule.classList.remove('active');
            }
        }

        function executeMigration() {
            const execMode = document.querySelector('input[name="execMode"]:checked');

            if (!execMode) {
                alert('‚ö†Ô∏è Please select an execution mode.');
                return;
            }

            if (execMode.value === 'now') {
                // Execute immediately
                if (confirm('üöÄ Execute Migration Now?\n\nThis will start the migration process immediately.\n\nSource: Production\nTarget: Development\nPipelines: 1 selected\n\nProceed?')) {
                    alert('‚úÖ Migration Started!\n\nJob ID: MIG-2026-001\nStatus: Running\n\nYou can monitor progress in the Monitoring section.');
                }
            } else {
                // Schedule for later
                const frequency = document.getElementById('schedule-frequency')?.value;
                const date = document.getElementById('schedule-date')?.value;
                const time = document.getElementById('schedule-time')?.value;
                const timezone = document.getElementById('schedule-timezone')?.value;

                if (!date || !time) {
                    alert('‚ö†Ô∏è Please select both date and time for scheduled execution.');
                    return;
                }

                if (confirm(`üìÖ Schedule Migration?\n\nFrequency: ${frequency}\nStart Date: ${date}\nStart Time: ${time}\nTimezone: ${timezone}\n\nProceed?`)) {
                    alert(`‚úÖ Migration Scheduled!\n\nSchedule ID: SCH-2026-001\nNext Run: ${date} ${time} ${timezone}\nFrequency: ${frequency}\n\nYou can view and manage schedules in the Schedules section.`);
                }
            }
        }

        // --- DM SCHEDULE & EXECUTION LOGIC ---

        function toggleDMScheduleOptions() {
            const toggle = document.getElementById('dm-exec-mode-toggle');
            const scheduleOptions = document.getElementById('dm-schedule-options');
            const executeBtn = document.getElementById('dm-execute-btn');
            const labelRunNow = document.getElementById('dm-label-run-now');
            const labelSchedule = document.getElementById('dm-label-schedule');

            if (toggle && toggle.checked) {
                // Schedule for Later is selected
                scheduleOptions.classList.remove('hidden');
                if (executeBtn) {
                    executeBtn.innerHTML = 'üìÖ Schedule Mapping';
                }
                labelRunNow.classList.remove('active');
                labelSchedule.classList.add('active');
            } else {
                // Run Now is selected
                scheduleOptions.classList.add('hidden');
                if (executeBtn) {
                    executeBtn.innerHTML = 'üöÄ Execute Now';
                }
                labelRunNow.classList.add('active');
                labelSchedule.classList.remove('active');
            }
        }

        function executeDMMapping() {
            const execMode = document.querySelector('input[name="dmExecMode"]:checked');

            if (!execMode) {
                alert('‚ö†Ô∏è Please select an execution mode.');
                return;
            }

            const targetTable = document.getElementById('summary-target')?.textContent || 'Target Table';
            const sourceSystem = document.getElementById('summary-source')?.textContent || 'Source System';
            const strategy = document.getElementById('summary-strategy')?.textContent || 'Load Strategy';

            if (execMode.value === 'now') {
                // Execute immediately
                if (confirm(`üöÄ Execute Mapping Now?\n\nThis will start the mapping pipeline immediately.\n\nTarget: ${targetTable}\nSource: ${sourceSystem}\nStrategy: ${strategy}\n\nProceed?`)) {
                    alert('‚úÖ Mapping Pipeline Started!\n\nJob ID: MAP-2026-001\nStatus: Running\n\nYou can monitor progress in the Monitoring section.');
                }
            } else {
                // Schedule for later
                const frequency = document.getElementById('dm-schedule-frequency')?.value;
                const date = document.getElementById('dm-schedule-date')?.value;
                const time = document.getElementById('dm-schedule-time')?.value;
                const timezone = document.getElementById('dm-schedule-timezone')?.value;

                if (!date || !time) {
                    alert('‚ö†Ô∏è Please select both date and time for scheduled execution.');
                    return;
                }

                if (confirm(`üìÖ Schedule Mapping?\n\nFrequency: ${frequency}\nStart Date: ${date}\nStart Time: ${time}\nTimezone: ${timezone}\n\nProceed?`)) {
                    alert(`‚úÖ Mapping Scheduled!\n\nSchedule ID: SCH-MAP-2026-001\nNext Run: ${date} ${time} ${timezone}\nFrequency: ${frequency}\n\nYou can view and manage schedules in the Schedules section.`);
                }
            }
        }

        // --- WIZARD LOGIC ---

        // Tenant Migration Wizard State
        let tenantCurrentStep = 1;
        const tenantTotalSteps = 5;

        // DM Mapping Wizard State
        let dmCurrentStep = 1;
        const dmTotalSteps = 5;

        function changeStep(direction) {
            const newStep = tenantCurrentStep + direction;

            if (newStep >= 1 && newStep <= tenantTotalSteps) {
                tenantCurrentStep = newStep;
                updateTenantWizardUI();
            }
        }

        function changeDMStep(direction) {
            const newStep = dmCurrentStep + direction;

            if (newStep >= 1 && newStep <= dmTotalSteps) {
                dmCurrentStep = newStep;
                updateDMWizardUI();
            }
        }

        function updateTenantWizardUI() {
            const container = document.getElementById('tenant-migration');

            // Update Steps Visibility
            // Scoped to tenant-migration container to avoid conflicts
            container.querySelectorAll('.wizard-step').forEach((step, index) => {
                // Ensure we only select direct wizard steps of this flow
                if (step.id.startsWith('step-')) {
                    const stepNum = parseInt(step.id.split('-')[1]);
                    if (stepNum === tenantCurrentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                }
            });

            // Update Stepper Indicators
            container.querySelectorAll('.stepper-item').forEach((item, index) => {
                if (item.id.startsWith('stepper-')) {
                    const stepNum = parseInt(item.id.split('-')[1]);
                    item.classList.remove('active', 'completed');

                    if (stepNum === tenantCurrentStep) {
                        item.classList.add('active');
                        item.querySelector('.step-counter').textContent = stepNum;
                    } else if (stepNum < tenantCurrentStep) {
                        item.classList.add('completed');
                        item.querySelector('.step-counter').textContent = '‚úì';
                    } else {
                        item.querySelector('.step-counter').textContent = stepNum;
                    }
                }
            });

            // Update Buttons
            const backBtn = document.getElementById('btn-back');
            const nextBtn = document.getElementById('btn-next');

            if (tenantCurrentStep === 1) {
                backBtn.disabled = true;
                backBtn.style.opacity = '0.5';
                backBtn.style.cursor = 'not-allowed';
            } else {
                backBtn.disabled = false;
                backBtn.style.opacity = '1';
                backBtn.style.cursor = 'pointer';
            }

            if (tenantCurrentStep === tenantTotalSteps) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
                nextBtn.textContent = 'Next Step ‚Üí';
            }
        }

        function updateDMWizardUI() {
            const container = document.getElementById('dm-mapping');

            // Update Steps Visibility
            container.querySelectorAll('.wizard-step').forEach((step) => {
                if (step.id.startsWith('dm-step-')) {
                    const stepNum = parseInt(step.id.split('-')[2]);
                    if (stepNum === dmCurrentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                }
            });

            // Update Stepper Indicators
            container.querySelectorAll('.stepper-item').forEach((item) => {
                if (item.id.startsWith('dm-stepper-')) {
                    const stepNum = parseInt(item.id.split('-')[2]);
                    item.classList.remove('active', 'completed');

                    if (stepNum === dmCurrentStep) {
                        item.classList.add('active');
                        item.querySelector('.step-counter').textContent = stepNum;
                    } else if (stepNum < dmCurrentStep) {
                        item.classList.add('completed');
                        item.querySelector('.step-counter').textContent = '‚úì';
                    } else {
                        item.querySelector('.step-counter').textContent = stepNum;
                    }
                }
            });

            // Update Buttons
            const backBtn = document.getElementById('dm-btn-back');
            const nextBtn = document.getElementById('dm-btn-next');

            if (dmCurrentStep === 1) {
                backBtn.disabled = true;
                backBtn.style.opacity = '0.5';
                backBtn.style.cursor = 'not-allowed';
            } else {
                backBtn.disabled = false;
                backBtn.style.opacity = '1';
                backBtn.style.cursor = 'pointer';
            }

            if (dmCurrentStep === dmTotalSteps) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
                nextBtn.textContent = 'Next Step ‚Üí';
            }

            // Step 5 Special Logic
            if (dmCurrentStep === 5) {
                updateMigrationSummary();
            }
        }

        // Initialize Wizards
        document.addEventListener('DOMContentLoaded', () => {
            updateDMWizardUI();

            // Initialize DM Connections
            loadDMConnections();
            renderDMConnections();

            // Initialize Data Source Connections
            loadDataConnections();
            renderDataConnections();

            // Initialize Chart
            initDashboardChart();
        });

        function initDashboardChart() {
            const ctx = document.getElementById('migrationTrendChart').getContext('2d');

            // Green Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.2)'); // Green
            gradient.addColorStop(1, 'rgba(16, 185, 129, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Migrations',
                        data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
                        borderColor: '#10b981', // Green 500
                        backgroundColor: gradient,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#10b981',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#fff',
                            titleColor: '#1e293b',
                            bodyColor: '#64748b',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f1f5f9',
                                borderDash: [5, 5]
                            },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // --- DATA SOURCE CRUD LOGIC ---

        // Initial Dummy Data
        const defaultDataConnections = [
            { id: '101', name: 'Global Salesforce', type: 'Salesforce', host: 'https://login.salesforce.com', user: 'admin@company.com', status: 'Active' },
            { id: '102', name: 'Legacy ERP (NetSuite)', type: 'NetSuite', host: 'system.netsuite.com', user: 'integ_user', status: 'Active' }
        ];

        let dataConnections = [];

        function loadDataConnections() {
            const stored = localStorage.getItem('dataConnections');
            if (stored) {
                dataConnections = JSON.parse(stored);
            } else {
                dataConnections = [...defaultDataConnections];
                saveToLocalStorageData();
            }
        }

        function saveToLocalStorageData() {
            localStorage.setItem('dataConnections', JSON.stringify(dataConnections));
        }

        function renderDataConnections() {
            const tbody = document.getElementById('data-connections-list');
            tbody.innerHTML = '';

            if (dataConnections.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 20px;">No source connections found. Click "+ Add Source" to create one.</td></tr>';
                return;
            }

            dataConnections.forEach(conn => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight: 500; color: #111827;">${conn.name}</td>
                    <td><span class="badge" style="background: #eef2ff; color: #4338ca;">${conn.type}</span></td>
                    <td>${conn.host}</td>
                    <td>${conn.user}</td>
                    <td><span class="badge" style="background: #dcfce7; color: #166534;">Active</span></td>
                    <td style="text-align: right;">
                        <button class="btn-icon" onclick="openDataModal('edit', '${conn.id}')" title="Edit">‚úèÔ∏è</button>
                        <button class="btn-icon delete" onclick="deleteDataConnection('${conn.id}')" title="Delete">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openDataModal(mode, id = null) {
            const modal = document.getElementById('data-connection-modal');
            const title = document.getElementById('data-modal-title');

            // Reset Form
            document.querySelectorAll('#data-connection-modal input').forEach(i => i.value = '');
            document.getElementById('data-conn-type').value = 'Salesforce';
            toggleDataFields();

            if (mode === 'edit' && id) {
                const conn = dataConnections.find(c => c.id === id);
                if (conn) {
                    document.getElementById('data-conn-id').value = conn.id;
                    document.getElementById('data-conn-name').value = conn.name;
                    document.getElementById('data-conn-type').value = conn.type;
                    document.getElementById('data-conn-host').value = conn.host;
                    document.getElementById('data-conn-user').value = conn.user;
                    // Mock password fill
                    document.getElementById('data-conn-pass').value = '********';

                    if (conn.account) document.getElementById('data-conn-account').value = conn.account;
                    if (conn.role) document.getElementById('data-conn-role').value = conn.role;
                    if (conn.authMethod) document.getElementById('data-conn-auth-method').value = conn.authMethod;

                    title.textContent = 'Edit Data Source';
                    toggleDataFields();
                }
            } else {
                document.getElementById('data-conn-id').value = '';
                title.textContent = 'Add Data Source';
            }

            modal.classList.remove('hidden');
        }

        function closeDataModal() {
            document.getElementById('data-connection-modal').classList.add('hidden');
        }

        function toggleDataFields() {
            const type = document.getElementById('data-conn-type').value;
            const nsExtra = document.getElementById('data-extra-netsuite');
            const wsExtra = document.getElementById('data-extra-webservice');
            const hostLbl = document.getElementById('lbl-data-host');
            const hostInput = document.getElementById('data-conn-host');

            // Reset visibility
            nsExtra.classList.add('hidden');
            wsExtra.classList.add('hidden');

            if (type === 'Salesforce') {
                hostLbl.textContent = 'Login URL';
                hostInput.placeholder = 'https://login.salesforce.com';
            } else if (type === 'NetSuite') {
                nsExtra.classList.remove('hidden');
                hostLbl.textContent = 'RESTlet Base URL';
                hostInput.placeholder = 'https://1234567.restlets.api.netsuite.com';
            } else if (type === 'Epicor') {
                hostLbl.textContent = 'Server Host / API URL';
                hostInput.placeholder = 'https://epicor-server/api/v1';
            } else if (type === 'WebService') {
                wsExtra.classList.remove('hidden');
                hostLbl.textContent = 'Endpoint URL';
                hostInput.placeholder = 'https://api.example.com/v1';
            }
        }

        function saveDataConnection() {
            const id = document.getElementById('data-conn-id').value;
            const name = document.getElementById('data-conn-name').value;
            const type = document.getElementById('data-conn-type').value;
            const host = document.getElementById('data-conn-host').value;
            const user = document.getElementById('data-conn-user').value;

            // Optional fields
            const account = document.getElementById('data-conn-account').value;
            const role = document.getElementById('data-conn-role').value;
            const authMethod = document.getElementById('data-conn-auth-method').value;

            if (!name || !host || !user) {
                alert('Please fill in required fields (Name, Host, User).');
                return;
            }

            const newConn = {
                id: id || 'data-' + Date.now().toString(),
                name,
                type,
                host,
                user,
                account: type === 'NetSuite' ? account : null,
                role: type === 'NetSuite' ? role : null,
                authMethod: type === 'WebService' ? authMethod : null,
                status: 'Active'
            };

            if (id) {
                // Update existing
                const index = dataConnections.findIndex(c => c.id === id);
                if (index !== -1) {
                    dataConnections[index] = newConn;
                }
            } else {
                // Create new
                dataConnections.push(newConn);
            }

            saveToLocalStorageData();
            renderDataConnections();
            closeDataModal();
            alert(id ? 'Source updated successfully.' : 'Source created successfully.');
        }

        function deleteDataConnection(id) {
            if (confirm('Are you sure you want to delete this source?')) {
                dataConnections = dataConnections.filter(c => c.id !== id);
                saveToLocalStorageData();
                renderDataConnections();
            }
        }

        function testDataConnection() {
            const host = document.getElementById('data-conn-host').value;
            if (!host) {
                alert('Please enter a Host/URL to test.');
                return;
            }
            alert(`Pinging ${host}...\n\n‚úÖ Connection Successful!`);
        }

        // --- DM SOURCE CRUD LOGIC ---

        // Initial Dummy Data (if no local storage)
        const defaultDMConnections = [
            { id: '1', name: 'Sales Snowflake', type: 'snowflake', host: 'xy12345.us-east.snowflakecomputing.com', db: 'SALES_DB', user: 'admin', status: 'Active' },
            { id: '2', name: 'Legacy Postgres', type: 'postgresql', host: 'db-prod-01.internal', db: 'legacy_data', user: 'read_only', status: 'Active' }
        ];

        let dmConnections = [];

        function loadDMConnections() {
            const stored = localStorage.getItem('dmConnections');
            if (stored) {
                dmConnections = JSON.parse(stored);
            } else {
                dmConnections = [...defaultDMConnections];
                saveToLocalStorage();
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem('dmConnections', JSON.stringify(dmConnections));
        }

        function renderDMConnections() {
            const tbody = document.getElementById('dm-connections-list');
            tbody.innerHTML = '';

            if (dmConnections.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding: 20px;">No connections found. Click "Add Connection" to create one.</td></tr>';
                return;
            }

            dmConnections.forEach(conn => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight: 500; color: #111827;">${conn.name}</td>
                    <td><span class="badge" style="background: #f3f4f6; color: #374151;">${conn.type}</span></td>
                    <td>${conn.host}</td>
                    <td>${conn.db}</td>
                    <td><span class="badge" style="background: #dcfce7; color: #166534;">Active</span></td>
                    <td style="text-align: right;">
                        <button class="btn-icon" onclick="openDMModal('edit', '${conn.id}')" title="Edit">‚úèÔ∏è</button>
                        <button class="btn-icon delete" onclick="deleteDMConnection('${conn.id}')" title="Delete">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openDMModal(mode, id = null) {
            const modal = document.getElementById('dm-connection-modal');
            const title = document.getElementById('modal-title');

            // Reset Form return
            document.querySelectorAll('#dm-connection-modal input').forEach(i => i.value = '');
            document.getElementById('dm-conn-type').value = 'snowflake';
            toggleDMFields();

            if (mode === 'edit' && id) {
                const conn = dmConnections.find(c => c.id === id);
                if (conn) {
                    document.getElementById('dm-conn-id').value = conn.id;
                    document.getElementById('dm-conn-name').value = conn.name;
                    document.getElementById('dm-conn-type').value = conn.type;
                    document.getElementById('dm-conn-host').value = conn.host;
                    document.getElementById('dm-conn-db').value = conn.db;
                    document.getElementById('dm-conn-user').value = conn.user;
                    // Mock password fill
                    document.getElementById('dm-conn-pass').value = '********';

                    if (conn.warehouse) document.getElementById('dm-conn-warehouse').value = conn.warehouse;

                    title.textContent = 'Edit DM Source Connection';
                    toggleDMFields(); // Refresh fields based on type
                }
            } else {
                document.getElementById('dm-conn-id').value = '';
                title.textContent = 'Add DM Source Connection';
            }

            modal.classList.remove('hidden');
        }

        function closeDMModal() {
            document.getElementById('dm-connection-modal').classList.add('hidden');
        }

        function toggleDMFields() {
            const type = document.getElementById('dm-conn-type').value;
            const sfExtra = document.getElementById('dm-extra-snowflake');
            const hostLbl = document.getElementById('lbl-host');

            if (type === 'snowflake') {
                sfExtra.classList.remove('hidden');
                hostLbl.textContent = 'Account URL';
                document.getElementById('dm-conn-host').placeholder = 'xy12345.us-east-1.snowflakecomputing.com';
            } else {
                sfExtra.classList.add('hidden');
                hostLbl.textContent = 'Host / IP Address';
                document.getElementById('dm-conn-host').placeholder = '192.168.1.100';
            }
        }

        function saveDMConnection() {
            const id = document.getElementById('dm-conn-id').value;
            const name = document.getElementById('dm-conn-name').value;
            const type = document.getElementById('dm-conn-type').value;
            const host = document.getElementById('dm-conn-host').value;
            const db = document.getElementById('dm-conn-db').value;
            const user = document.getElementById('dm-conn-user').value;
            const warehouse = document.getElementById('dm-conn-warehouse').value;

            if (!name || !host || !db || !user) {
                alert('Please fill in all required fields (Name, Host, Database, User).');
                return;
            }

            const newConn = {
                id: id || Date.now().toString(),
                name,
                type,
                host,
                db,
                user,
                warehouse: type === 'snowflake' ? warehouse : null,
                status: 'Active'
            };

            if (id) {
                // Update existing
                const index = dmConnections.findIndex(c => c.id === id);
                if (index !== -1) {
                    dmConnections[index] = newConn;
                }
            } else {
                // Create new
                dmConnections.push(newConn);
            }

            saveToLocalStorage();
            renderDMConnections();
            closeDMModal();
            alert(id ? 'Connection updated successfully.' : 'Connection created successfully.');
        }

        function deleteDMConnection(id) {
            if (confirm('Are you sure you want to delete this connection?')) {
                dmConnections = dmConnections.filter(c => c.id !== id);
                saveToLocalStorage();
                renderDMConnections();
            }
        }

        function testDMConnection() {
            const host = document.getElementById('dm-conn-host').value;
            if (!host) {
                alert('Please enter a Host/URL to test.');
                return;
            }
            alert(`Testing connection to ${host}...\n\n‚úÖ Connection Successful!`);
        }

        // --- DASHBOARD CHARTS ---
        // (Existing initDashboardChart function...)

        // --- LOAD STRATEGY SELECTION ---
        function selectLoadStrategy(strategy, cardElement) {
            // Update UI
            document.querySelectorAll('.strategy-card').forEach(c => c.classList.remove('selected'));
            cardElement.classList.add('selected');

            // Check radio button
            const radio = cardElement.querySelector('input[type="radio"]');
            if (radio) radio.checked = true;

            // Show/Hide Reverse Engineering Options
            if (strategy === 'reverse') {
                document.getElementById('reverse-engineering-options').classList.remove('hidden');
            } else {
                document.getElementById('reverse-engineering-options').classList.add('hidden');
            }
        }


        // --- STEP 5 ENHANCEMENTS ---

        function updateMigrationSummary() {
            // Get values
            const targetTable = document.getElementById('dm-table').value || 'Not Selected';
            const sourceSystem = document.getElementById('global-source-system').value || 'Not Selected';

            // Get Strategy
            let strategy = 'Not Selected';
            const strategyInput = document.querySelector('input[name="loadStrat"]:checked');
            if (strategyInput) {
                const map = {
                    'append': 'Append Only',
                    'merge': 'Merge (Upsert)',
                    'truncate': 'Truncate & Load',
                    'reverse': 'Reverse Engineering'
                };
                strategy = map[strategyInput.value] || strategyInput.value;
            }

            // Get Column Count
            const rowCount = document.querySelectorAll('#mapping-table tbody tr').length;

            // Update UI
            document.getElementById('summary-target').textContent = targetTable;
            document.getElementById('summary-source').textContent = sourceSystem;
            document.getElementById('summary-strategy').textContent = strategy;
            document.getElementById('summary-cols').textContent = rowCount;

            // Reset Validation UI
            const valBox = document.getElementById('validation-box');
            valBox.className = 'validation-box pending';
            valBox.querySelector('.validation-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
            document.getElementById('val-title').textContent = 'Ready to Validate';
            document.getElementById('val-desc').textContent = 'Click "Validate Configuration" to check connection, mappings, and data types.';
            document.getElementById('btn-save-mapping').disabled = true;
            document.getElementById('btn-validate-action').disabled = false;
            document.getElementById('btn-validate-action').textContent = 'Validate Configuration';
        }

        function validateConfiguration() {
            const valBox = document.getElementById('validation-box');
            const btn = document.getElementById('btn-validate-action');

            // Set Validating State
            valBox.className = 'validation-box validating';
            valBox.querySelector('.validation-icon').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            document.getElementById('val-title').textContent = 'Validating Configuration...';
            document.getElementById('val-desc').textContent = 'Checking source connectivity, target schema compatibility, and data types.';
            btn.disabled = true;
            btn.textContent = 'Validating...';

            // Simulate Validation
            setTimeout(() => {
                // Success State
                valBox.className = 'validation-box success';
                valBox.querySelector('.validation-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                document.getElementById('val-title').textContent = 'Configuration Validated';
                document.getElementById('val-desc').textContent = 'All checks passed. You can now save and activate this pipeline.';

                // Enable Save
                document.getElementById('btn-save-mapping').disabled = false;
                btn.textContent = 'Re-Validate';
                btn.disabled = false;
            }, 1500);
        }

        function saveMapping() {
            alert('‚úÖ Pipeline Saved Successfully!\n\nThe migration pipeline has been created and scheduled based on your configuration.');
            // Reset or Redirect
            navigateTo('dashboard', { preventDefault: () => { } });
        }
    </script>
    <script>
        // --- EXPORT MODAL LOGIC ---

        function openExportModal() {
            document.getElementById('export-modal').classList.remove('hidden');

            // Generate JSONs
            const config = generateConfigJSON();
            const job = generateDatabricksJobJSON(config);

            // Display
            document.getElementById('json-config').textContent = JSON.stringify(config, null, 2);
            document.getElementById('json-job').textContent = JSON.stringify(job, null, 2);
        }

        function closeExportModal() {
            document.getElementById('export-modal').classList.add('hidden');
        }

        function switchExportTab(tab) {
            // Update Tabs
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Update Content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
        }

        function copyExportJSON(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('JSON copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard.');
            });
        }

        function generateConfigJSON() {
            // reliable safe get val helper
            const getVal = (id) => {
                const el = document.getElementById(id);
                return el ? el.value : null;
            };

            const targetTable = getVal('dm-table');
            const sourceSystem = getVal('global-source-system');

            // Get Strategy
            let strategy = 'unknown';
            const strategyInput = document.querySelector('input[name="loadStrat"]:checked');
            if (strategyInput) strategy = strategyInput.value;

            // Get Mappings
            const mappings = [];
            document.querySelectorAll('#mapping-table tbody tr').forEach(row => {
                const cols = row.querySelectorAll('td');
                if (cols.length > 0) {
                    mappings.push({
                        dmColumn: cols[0].textContent.trim(),
                        sourceTable: row.querySelector('.source-table-select')?.value || '',
                        sourceColumn: row.querySelectorAll('select')[1]?.value || '',
                        transformation: row.querySelector('input[type="text"]')?.value || ''
                    });
                }
            });

            return {
                pipelineName: `Migrate_${sourceSystem}_to_${targetTable}`,
                created: new Date().toISOString(),
                source: {
                    system: sourceSystem,
                    connectionId: 'src-001', // Mock ID
                    tables: selectedTables
                },
                target: {
                    table: targetTable,
                    connectionId: 'dm-001' // Mock ID
                },
                strategy: {
                    type: strategy,
                    reverseEngineering: strategy === 'reverse'
                },
                mappings: mappings,
                validationStatus: 'Passed'
            };
        }

        function generateDatabricksJobJSON(config) {
            // Escape JSON string for passing as a parameter
            const configString = JSON.stringify(config).replace(/"/g, '\\"');

            return {
                "name": config.pipelineName,
                "email_notifications": {
                    "no_alert_for_skipped_runs": false
                },
                "webhook_notifications": {},
                "timeout_seconds": 0,
                "max_concurrent_runs": 1,
                "tasks": [
                    {
                        "task_key": "migration_task",
                        "spark_jar_task": {
                            "main_class_name": "com.anvizent.migration.Main",
                            "parameters": [
                                "--config",
                                JSON.stringify(config) // Pass full JSON object as string
                            ],
                            "jar_uri": "dbfs:/FileStore/jars/anvizent-migration-1.0.jar"
                        },
                        "job_cluster_key": "Job_Cluster",
                        "timeout_seconds": 0,
                        "email_notifications": {}
                    }
                ],
                "job_clusters": [
                    {
                        "job_cluster_key": "Job_Cluster",
                        "new_cluster": {
                            "cluster_name": "",
                            "spark_version": "13.3.x-scala2.12",
                            "aws_attributes": {
                                "first_on_demand": 1,
                                "availability": "SPOT_WITH_FALLBACK",
                                "zone_id": "us-west-2a",
                                "instance_profile_arn": null,
                                "spot_bid_price_percent": 100,
                                "ebs_volume_count": 0
                            },
                            "node_type_id": "i3.xlarge",
                            "spark_env_vars": {
                                "PYSPARK_PYTHON": "/databricks/python3/bin/python3"
                            },
                            "enable_elastic_disk": true,
                            "data_security_mode": "SINGLE_USER_MODE",
                            "runtime_engine": "STANDARD",
                            "num_workers": 2
                        }
                    }
                ],
                "format": "MULTI_TASK"
            };
        }
    </script>
    <script>
        // --- LINEAGE D3 VISUALIZATION ---

        function openLineageModal() {
            document.getElementById('lineage-modal').classList.remove('hidden');
            // Wait for modal to be visible before rendering D3 to get correct dimensions
            setTimeout(renderLineage, 100);
        }

        function closeLineageModal() {
            document.getElementById('lineage-modal').classList.add('hidden');
        }

        function renderLineage() {
            const container = document.getElementById('lineage-container');
            container.innerHTML = ''; // Clear previous

            const width = container.clientWidth;
            const height = container.clientHeight;
            const svg = d3.select("#lineage-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .call(d3.zoom().on("zoom", (event) => {
                    g.attr("transform", event.transform);
                }))
                .append("g");

            const g = svg.append("g");

            // --- DATA PREPARATION ---
            // 1. Get Source Table (Node A)
            const sourceSystem = document.getElementById('global-source-system').value || 'Source System';
            const sourceTables = selectedTables.length > 0 ? selectedTables.map(t => t.name) : ['Source Table'];

            // 2. Get Target Table (Node B)
            const inputTarget = document.getElementById('dm-table');
            const targetTable = inputTarget && inputTarget.value ? inputTarget.value : 'Target Table';

            // 3. Get Mappings (Links)
            const mappings = [];
            document.querySelectorAll('#mapping-table tbody tr').forEach((row, i) => {
                const cols = row.querySelectorAll('td');
                if (cols.length > 0) {
                    const targetCol = cols[0].textContent.trim();
                    const sourceColSelect = row.querySelectorAll('select')[1];
                    const sourceCol = sourceColSelect ? sourceColSelect.value : '';

                    if (sourceCol) {
                        mappings.push({
                            source: sourceCol,
                            target: targetCol,
                            id: `link-${i}`
                        });
                    }
                }
            });

            // If no mappings, add dummy data for visualization
            if (mappings.length === 0) {
                mappings.push({ source: 'src_id', target: 'id', id: 'l1' });
                mappings.push({ source: 'src_name', target: 'name', id: 'l2' });
                mappings.push({ source: 'src_date', target: 'created_at', id: 'l3' });
            }

            // --- LAYOUT CONFIG ---
            const nodeWidth = 200;
            const nodeHeight = 300; // Max height, scrollable if needed
            const xGap = 400;

            // --- DRAW SOURCE NODE (Left) ---
            const sourceGroup = g.append("g")
                .attr("class", "node")
                .attr("transform", `translate(100, 100)`);

            // Box
            sourceGroup.append("rect")
                .attr("width", nodeWidth)
                .attr("height", nodeHeight)
                .attr("rx", 8);

            // Header
            sourceGroup.append("rect")
                .attr("width", nodeWidth)
                .attr("height", 30)
                .attr("fill", "#f1f5f9")
                .attr("stroke", "none")
                .attr("rx", 8) // Top rounded only usually, but kept simple
                .style("clip-path", "inset(0 0 10px 0)"); // Hack to square bottom

            sourceGroup.append("text")
                .attr("x", 10)
                .attr("y", 20)
                .text(sourceSystem + " (Source)")
                .attr("font-weight", "bold");

            // Columns (Source)
            const sourceCols = [...new Set(mappings.map(m => m.source))];
            sourceCols.forEach((col, i) => {
                sourceGroup.append("text")
                    .attr("x", 10)
                    .attr("y", 50 + (i * 25))
                    .text(col)
                    .attr("id", `src-${col}`)
                    .style("font-size", "12px");

                // Dot connector
                sourceGroup.append("circle")
                    .attr("cx", nodeWidth)
                    .attr("cy", 46 + (i * 25))
                    .attr("r", 4)
                    .attr("fill", "#cbd5e1");
            });


            // --- DRAW TARGET NODE (Right) ---
            const targetGroup = g.append("g")
                .attr("class", "node")
                .attr("transform", `translate(${100 + nodeWidth + xGap}, 100)`);

            // Box
            targetGroup.append("rect")
                .attr("width", nodeWidth)
                .attr("height", nodeHeight)
                .attr("rx", 8);

            // Header
            targetGroup.append("rect")
                .attr("width", nodeWidth)
                .attr("height", 30)
                .attr("fill", "#ecfdf5") // Green tint
                .attr("rx", 8)
                .style("clip-path", "inset(0 0 10px 0)");

            targetGroup.append("text")
                .attr("x", 10)
                .attr("y", 20)
                .text(targetTable + " (Target)")
                .attr("font-weight", "bold")
                .attr("fill", "#059669");

            // Columns (Target)
            const targetCols = [...new Set(mappings.map(m => m.target))];
            targetCols.forEach((col, i) => {
                targetGroup.append("text")
                    .attr("x", 20) // Indent for dot
                    .attr("y", 50 + (i * 25))
                    .text(col)
                    .attr("id", `tgt-${col}`)
                    .style("font-size", "12px");

                // Dot connector
                targetGroup.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 46 + (i * 25))
                    .attr("r", 4)
                    .attr("fill", "#10b981");
            });

            // --- DRAW LINKS ---
            // Simple straight lines or curves connecting matched indices
            const linkGen = d3.linkHorizontal()
                .x(d => d.x)
                .y(d => d.y);

            mappings.forEach(m => {
                const srcIdx = sourceCols.indexOf(m.source);
                const tgtIdx = targetCols.indexOf(m.target);

                if (srcIdx !== -1 && tgtIdx !== -1) {
                    const d = {
                        source: { x: 100 + nodeWidth, y: 100 + 46 + (srcIdx * 25) },
                        target: { x: 100 + nodeWidth + xGap, y: 100 + 46 + (tgtIdx * 25) }
                    };

                    g.append("path")
                        .datum(d)
                        .attr("class", "link")
                        .attr("d", linkGen)
                        .attr("stroke", "#cbd5e1")
                        .attr("stroke-width", 2)
                        .attr("fill", "none");
                }
            });
        }

        function exportLineageSVG() {
            const svgData = document.getElementById('lineage-container').innerHTML;
            const blob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "lineage_diagram.svg";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

    </script>

</body>

</html>
